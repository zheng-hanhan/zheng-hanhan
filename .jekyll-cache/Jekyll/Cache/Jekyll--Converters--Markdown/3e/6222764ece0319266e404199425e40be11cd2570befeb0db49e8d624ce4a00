I"m7<h2 id="简介">简介</h2>
<p>笔者在编译产物中直接执行out/soong/host/linux-x86/bin/dex2oatd，
该命令会输出编译选项，如下：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
</pre></td><td class="rouge-code"><pre>Output must be supplied with either --oat-file or --oat-fd
 Command: out/soong/host/linux-x86/bin/dex2oatd
 Usage: dex2oat [options]...
 
   -j&lt;number&gt;: specifies the number of threads used for compilation.
        Default is the number of detected hardware threads available on the
        host system.
       Example: -j12
 
   --cpu-set=&lt;set&gt;: sets the cpu affinity to &lt;set&gt;. The &lt;set&gt; argument is a comma
     separated list of CPUs.
     Example: --cpu-set=0,1,2,3
 
   --dex-file=&lt;dex-file&gt;: specifies a .dex, .jar, or .apk file to compile.
       Example: --dex-file=/system/framework/core.jar
 
   --dex-location=&lt;dex-location&gt;: specifies an alternative dex location to
       encode in the oat file for the corresponding --dex-file argument.
       Example: --dex-file=/home/build/out/system/framework/core.jar
                --dex-location=/system/framework/core.jar
 
   --zip-fd=&lt;file-descriptor&gt;: specifies a file descriptor of a zip file
       containing a classes.dex file to compile.
       Example: --zip-fd=5
 
   --zip-location=&lt;zip-location&gt;: specifies a symbolic name for the file
       corresponding to the file descriptor specified by --zip-fd.
       Example: --zip-location=/system/app/Calculator.apk
 
   --oat-file=&lt;file.oat&gt;: specifies an oat output destination via a filename.
       Example: --oat-file=/system/framework/boot.oat
 
   --oat-fd=&lt;number&gt;: specifies the oat output destination via a file descriptor.
       Example: --oat-fd=6
 
   --input-vdex-fd=&lt;number&gt;: specifies the vdex input source via a file descriptor.
       Example: --input-vdex-fd=6
 
   --output-vdex-fd=&lt;number&gt;: specifies the vdex output destination via a file
       descriptor.
       Example: --output-vdex-fd=6
 
   --oat-location=&lt;oat-name&gt;: specifies a symbolic name for the file corresponding
       to the file descriptor specified by --oat-fd.
       Example: --oat-location=/data/dalvik-cache/system@app@Calculator.apk.oat
 
   --oat-symbols=&lt;file.oat&gt;: specifies a destination where the oat file is copied.
       This is equivalent to file copy as build post-processing step.
       It is intended to be used with --strip and it happens before it.
       Example: --oat-symbols=/symbols/system/framework/boot.oat
 
   --strip: remove all debugging sections at the end (but keep mini-debug-info).
       This is equivalent to the "strip" command as build post-processing step.
       It is intended to be used with --oat-symbols and it happens after it.
       Example: --oat-symbols=/symbols/system/framework/boot.oat
 
   --image=&lt;file.art&gt;: specifies an output image filename.
       Example: --image=/system/framework/boot.art
 
   --image-format=(uncompressed|lz4|lz4hc):
       Which format to store the image.
       Example: --image-format=lz4
       Default: uncompressed
 
   --image-classes=&lt;classname-file&gt;: specifies classes to include in an image.
       Example: --image=frameworks/base/preloaded-classes
 
   --base=&lt;hex-address&gt;: specifies the base address when creating a boot image.
       Example: --base=0x50000000
 
   --boot-image=&lt;file.art&gt;: provide the image file for the boot class path.
       Do not include the arch as part of the name, it is added automatically.
       Example: --boot-image=/system/framework/boot.art
                (specifies /system/framework/&lt;arch&gt;/boot.art as the image file)
       Default: $ANDROID_ROOT/system/framework/boot.art
 
   --android-root=&lt;path&gt;: used to locate libraries for portable linking.
       Example: --android-root=out/host/linux-x86
       Default: $ANDROID_ROOT
 
   --instruction-set=(arm|arm64|mips|mips64|x86|x86_64): compile for a particular
       instruction set.
       Example: --instruction-set=x86
       Default: arm
 
   --instruction-set-features=...,: Specify instruction set features
       On target the value 'runtime' can be used to detect features at run time.
       If target does not support run-time detection the value 'runtime'
       has the same effect as the value 'default'.
       Note: the value 'runtime' has no effect if it is used on host.
       Example: --instruction-set-features=div
       Default: default
 
   --compiler-backend=(Quick|Optimizing): select compiler backend
       set.
       Example: --compiler-backend=Optimizing
       Default: Optimizing
 
   --compiler-filter=(assume-verified|extract|verify|quicken|space-profile|space|speed-profile|speed|everything-profile|everything):
       select compiler filter.
       Example: --compiler-filter=everything
       Default: speed
 
   --huge-method-max=&lt;method-instruction-count&gt;: threshold size for a huge
       method for compiler filter tuning.
       Example: --huge-method-max=10000
       Default: 10000
 
   --large-method-max=&lt;method-instruction-count&gt;: threshold size for a large
       method for compiler filter tuning.
       Example: --large-method-max=600
       Default: 600
 
   --small-method-max=&lt;method-instruction-count&gt;: threshold size for a small
       method for compiler filter tuning.
       Example: --small-method-max=60
       Default: 60
 
   --tiny-method-max=&lt;method-instruction-count&gt;: threshold size for a tiny
       method for compiler filter tuning.
       Example: --tiny-method-max=20
       Default: 20
 
   --num-dex-methods=&lt;method-count&gt;: threshold size for a small dex file for
       compiler filter tuning. If the input has fewer than this many methods
       and the filter is not interpret-only or verify-none or verify-at-runtime, 
       overrides the filter to use speed
       Example: --num-dex-method=900
       Default: 900
 
   --inline-max-code-units=&lt;code-units-count&gt;: the maximum code units that a method
       can have to be considered for inlining. A zero value will disable inlining.
       Honored only by Optimizing. Has priority over the --compiler-filter option.
       Intended for development/experimental use.
       Example: --inline-max-code-units=32
       Default: 32
 
   --dump-timings: display a breakdown of where time was spent
 
   --dump-pass-timings: display a breakdown of time spent in optimization
       passes for each compiled method.
 
   -g
   --generate-debug-info: Generate debug information for native debugging,
       such as stack unwinding information, ELF symbols and DWARF sections.
       If used without --debuggable, it will be best-effort only.
       This option does not affect the generated code. (disabled by default)
 
   --no-generate-debug-info: Do not generate debug information for native debugging.
 
   --generate-mini-debug-info: Generate minimal amount of LZMA-compressed
       debug information necessary to print backtraces. (disabled by default)
 
   --no-generate-mini-debug-info: Do not generate backtrace info.
 
   --generate-build-id: Generate GNU-compatible linker build ID ELF section with
       SHA-1 of the file content (and thus stable across identical builds)
 
   --no-generate-build-id: Do not generate the build ID ELF section.
 
   --debuggable: Produce code debuggable with Java debugger.
 
   --avoid-storing-invocation: Avoid storing the invocation args in the key value
       store. Used to test determinism with different args.
 
   --write-invocation-to=&lt;file&gt;: Write the invocation commandline to the given file
       for later use. Used to test determinism with different host architectures.
 
   --runtime-arg &lt;argument&gt;: used to specify various arguments for the runtime,
       such as initial heap size, maximum heap size, and verbose output.
       Use a separate --runtime-arg switch for each argument.
       Example: --runtime-arg -Xms256m
 
   --profile-file=&lt;filename&gt;: specify profiler output file to use for compilation.
 
   --profile-file-fd=&lt;number&gt;: same as --profile-file but accepts a file descriptor.
       Cannot be used together with --profile-file.
 
   --swap-file=&lt;file-name&gt;: specifies a file to use for swap.
       Example: --swap-file=/data/tmp/swap.001
 
   --swap-fd=&lt;file-descriptor&gt;: specifies a file to use for swap (by descriptor).
       Example: --swap-fd=10
 
   --swap-dex-size-threshold=&lt;size&gt;: specifies the minimum total dex file size in
       bytes to allow the use of swap.
       Example: --swap-dex-size-threshold=1000000
       Default: 20971520
 
   --swap-dex-count-threshold=&lt;count&gt;: specifies the minimum number of dex files to
       allow the use of swap.
       Example: --swap-dex-count-threshold=10
       Default: 2
 
   --very-large-app-threshold=&lt;size&gt;: specifies the minimum total dex file size in
       bytes to consider the input "very large" and reduce compilation done.
       Example: --very-large-app-threshold=100000000
 
   --app-image-fd=&lt;file-descriptor&gt;: specify output file descriptor for app image.
       The image is non-empty only if a profile is passed in.
       Example: --app-image-fd=10
 
   --app-image-file=&lt;file-name&gt;: specify a file name for app image.
       Example: --app-image-file=/data/dalvik-cache/system@app@Calculator.apk.art
 
   --multi-image: obsolete, ignored
 
   --force-determinism: force the compiler to emit a deterministic output.
 
   --dump-cfg=&lt;cfg-file&gt;: dump control-flow graphs (CFGs) to specified file.
       Example: --dump-cfg=output.cfg
 
   --dump-cfg-append: when dumping CFGs to an existing file, append new CFG data to
       existing data (instead of overwriting existing data with new data, which is
       the default behavior). This option is only meaningful when used with
       --dump-cfg.
 
   --classpath-dir=&lt;directory-path&gt;: directory used to resolve relative class paths.
 
   --class-loader-context=&lt;string spec&gt;: a string specifying the intended
       runtime loading context for the compiled dex files.
 
   --stored-class-loader-context=&lt;string spec&gt;: a string specifying the intended
       runtime loading context that is stored in the oat file. Overrides
       --class-loader-context. Note that this ignores the classpath_dir arg.
 
       It describes how the class loader chain should be built in order to ensure
       classes are resolved during dex2aot as they would be resolved at runtime.
       This spec will be encoded in the oat file. If at runtime the dex file is
       loaded in a different context, the oat file will be rejected.
 
       The chain is interpreted in the natural 'parent order', meaning that class
       loader 'i+1' will be the parent of class loader 'i'.
       The compilation sources will be appended to the classpath of the first class
       loader.
 
       E.g. if the context is 'PCL[lib1.dex];DLC[lib2.dex]' and 
       --dex-file=src.dex then dex2oat will setup a PathClassLoader with classpath 
       'lib1.dex:src.dex' and set its parent to a DelegateLastClassLoader with 
       classpath 'lib2.dex'.
 
       Note that the compiler will be tolerant if the source dex files specified
       with --dex-file are found in the classpath. The source dex files will be
       removed from any class loader's classpath possibly resulting in empty
       class loaders.
 
       Example: --class-loader-context=PCL[lib1.dex:lib2.dex];DLC[lib3.dex]
 
   --class-loader-context-fds=&lt;fds&gt;: a colon-separated list of file descriptors
       for dex files in --class-loader-context. Their order must be the same as
       dex files in flattened class loader context.
 
   --dirty-image-objects=&lt;directory-path&gt;: list of known dirty objects in the image.
       The image writer will group them together.
 
   --compact-dex-level=none|fast: None avoids generating compact dex, fast
       generates compact dex with low compile time. If speed-profile is specified as
       the compiler filter and the profile is not empty, the default compact dex
       level is always used.
 
   --deduplicate-code=true|false: enable|disable code deduplication. Deduplicated
       code will have an arbitrary symbol tagged with [DEDUPED].
 
   --copy-dex-files=true|false: enable|disable copying the dex files into the
       output vdex.
 
   --compilation-reason=&lt;string&gt;: optional metadata specifying the reason for
       compiling the apk. If specified, the string will be embedded verbatim in
       the key value store of the oat file.
       Example: --compilation-reason=install
 
   --resolve-startup-const-strings=true|false: If true, the compiler eagerly
       resolves strings referenced from const-string of startup methods.
 
   --max-image-block-size=&lt;size&gt;: Maximum solid block size for compressed images.
 
See log for usage error information
</pre></td></tr></tbody></table></code></pre></div></div>

:ET